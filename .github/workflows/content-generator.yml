
name: Weekly Content Generation

on:
  schedule:
    # Runs every Sunday at 2:00 AM UTC
    - cron: '0 2 * * 0'
  workflow_dispatch: # Allows manual triggering

jobs:
  generate_content:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Install Dependencies and Generate Post
        run: |
          cd "tc-enterprises-site-autoblog"
          npm install
          node ./scripts/generate-post.mjs
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "feat(blog): add new draft post"
          branch: "content/new-post-${{ github.run_id }}"
          base: "main"
          title: "New Blog Post Draft for Review"
          body: |
            A new blog post has been automatically generated by the content workflow.

            Please review the new file in the `content/blog` directory and merge this PR to publish.
